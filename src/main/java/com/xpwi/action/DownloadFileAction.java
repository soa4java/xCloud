package com.xpwi.action;import com.xpwi.service.IDownloadFileService;import com.xpwi.service.impl.DownloadFileServiceImpl;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.context.annotation.Scope;import org.springframework.stereotype.Controller;import org.springframework.stereotype.Repository;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestMethod;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.BufferedInputStream;import java.io.BufferedOutputStream;import java.io.File;import java.io.FileInputStream;@Controller@Scope("prototype")@RequestMapping("/file")public class DownloadFileAction {    @Autowired    IDownloadFileService downloadFileServiceImpl;    //下载文件    @RequestMapping(value = "/downloadFile.do",method = RequestMethod.GET)    public int downloadFile(int file_id,String filePath, String fileName, HttpServletRequest request, HttpServletResponse response){        System.out.println(filePath);        String realPath = request.getSession().getServletContext().getRealPath("myphoto/file_resources")+filePath+"/"+fileName;        try {            File file = new File(realPath);            response.setContentType("application/x-msdownload;");            response.setHeader("Content-disposition","attachment;filename="+                    new String(fileName.getBytes("utf-8"),"ISO8859-1"));            response.setHeader("Content-Length",String.valueOf(file.length()));            BufferedInputStream bufferedInputStream = new BufferedInputStream(new FileInputStream(file));            BufferedOutputStream bufferedOutputStream = new BufferedOutputStream(response.getOutputStream());            byte[] size = new byte[1024];            int length = 0;            while ((length=bufferedInputStream.read(size))!= -1) {                bufferedOutputStream.write(size,0,length);            }            bufferedOutputStream.flush();            bufferedOutputStream.close();            bufferedInputStream.close();            System.out.println("【下载文件】"+realPath);            //更新下载次数            int i = downloadFileServiceImpl.updateDownloadCount(file_id);            System.out.println("【下载次数+1】"+fileName);            return i;        } catch (Exception e){            e.printStackTrace();        }        return 0;    }}
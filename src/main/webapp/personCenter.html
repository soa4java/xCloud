<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <title>网络云盘客户端-个人中心</title>    <link rel="stylesheet" href="node_modules/layui-src/dist/css/layui.css">    <script type="text/javascript" src="node_modules/jquery/dist/jquery.min.js"></script>    <script type="text/javascript" src="node_modules/layui-src/dist/layui.all.js"></script>    <script>        function updateUserInfo() {            var user_id = sessionStorage.getItem("user_id");            $.ajax({                url: "user/updateInfo.do?user_id=" + user_id,                method: "post",                data: $("#updateUserForm").serialize(),                success: function (result) {                    if (result > 0)                        layer.msg("更新个人信息成功!", {                            time: 2000                        });                    else                        layer.msg("更新个人信息失败!", {                            time: 2000                        });                },                error: function () {                    layer.msg("请求服务器失败!", {                        time: 2000                    });                }            });        }        function formatDate(date) {            var d = new Date(date),                month = '' + (d.getMonth() + 1),                day = '' + d.getDate(),                year = d.getFullYear();            if (month.length < 2) month = '0' + month;            if (day.length < 2) day = '0' + day;            return [year, month, day].join('-');        }        $(function () {            $("#demo1").attr("src", sessionStorage.getItem("headPath"));            parent.$("#userPhoto").attr("src", sessionStorage.getItem("headPath"));            var user_id = sessionStorage.getItem("user_id");            $.ajax({                url: "user/findUserInfoById.do",                method: "get",                data: {"userid": user_id},                success: function (result) {                    // alert(result);                    var jsonObj = JSON.parse(result);//将json字符串转化为JSON对象                    var birthday = new Date(jsonObj.birthday).toLocaleDateString();                    var birthday_ = formatDate(birthday);                    if (jsonObj.photo != null)                        $("#demo1").attr("src", jsonObj.photo);                    $("#username").val(jsonObj.username);                    $("#rname").val(jsonObj.runame);                    $("#birthday").val(birthday_);                    $("#phone").val(jsonObj.telephone);                    $("#address").val(jsonObj.address);                    $("#remark").val(jsonObj.remark);                    //性别                    var gender = jsonObj.gender;                    if (gender == '男') {                        $("input[name='gender'][value='男']").prop("checked", true);                    }                    if (gender == '女') {                        $("input[name='gender'][value='女']").prop("checked", true);                    }                    //要想设置性别需要更新渲染                    layui.use(['form'], function () {                        var form = layui.form;                        form.render();  //更新渲染                    });                },                error: function () {                    layer.msg("请求服务器失败!", {                        time: 2000                    });                }            });        });    </script></head><body><fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">    <legend>完善个人信息</legend></fieldset><div class="layui-row">    <div class="layui-col-md6">        <form id="updateUserForm" class="layui-form">            <div class="layui-form-item">                <label class="layui-form-label">用户名</label>                <div class="layui-input-inline">                    <input id="username" name="username" class="layui-input" type="text" autocomplete="off"                           lay-verify="title" disabled>                </div>            </div>            <div class="layui-form-item">                <label class="layui-form-label">真实姓名</label>                <div class="layui-input-inline">                    <input id="rname" name="runame" class="layui-input" type="text" placeholder="请输入真实姓名"                           autocomplete="off"                           lay-verify="title">                </div>            </div>            <div class="layui-form-item">                <label class="layui-form-label">性别</label>                <div class="layui-input-block">                    <input id="man" name="gender" title="男" type="radio" value="男" lay-skin="primary"/>                    <input id="woman" name="gender" title="女" type="radio" value="女" checked="checked"                           lay-skin="primary"/>                </div>            </div>            <div class="layui-form-item">                <div class="layui-inline">                    <label class="layui-form-label">出生日期</label>                    <div class="layui-input-inline">                        <input id="birthday" name="birthday" class="layui-input" id="date" type="text"                               placeholder="yyyy-MM-dd"                               autocomplete="off" lay-verify="date">                    </div>                </div>            </div>            <div class="layui-form-item">                <div class="layui-inline">                    <label class="layui-form-label">联系电话</label>                    <div class="layui-input-inline">                        <input id="phone" name="telephone" class="layui-input" type="tel" autocomplete="off"                               placeholder="请输入联系电话">                    </div>                </div>            </div>            <div class="layui-form-item">                <label class="layui-form-label">家庭地址</label>                <div class="layui-input-block">                    <input id="address" name="address" class="layui-input" type="text" placeholder="请输入家庭地址"                           autocomplete="off"                           lay-verify="title">                </div>            </div>            <div class="layui-form-item layui-form-text">                <label class="layui-form-label">个人简介</label>                <div class="layui-input-block">                    <textarea id="remark" name="remark" class="layui-textarea" placeholder="请输入内容"></textarea>                </div>            </div>            <div class="layui-form-item">                <div class="layui-input-block">                    <a href="javascript:updateUserInfo()" class="layui-btn">更新信息</a>                    <button class="layui-btn layui-btn-primary" type="reset">重置</button>                </div>            </div>        </form>    </div>    <div class="layui-col-md3">        <div class="layui-upload layui-col-lg-offset2" align="center">            <div class="layui-upload-list">                <img class="layui-upload-img" id="demo1" src="myphoto/myphoto.jpg" style="width: 50%">                <p id="demoText"></p>            </div>            <button type="button" class="layui-btn" id="test1">更换头像</button>        </div>    </div></div><script>    layui.use('upload', function () {        var $ = layui.jquery            , upload = layui.upload;        //普通图片上传        var uploadInst = upload.render({            elem: '#test1'            , url: 'file/uploadPersonPhoto.do'            , before: function (obj) {                //预读本地文件示例，不支持ie8                obj.preview(function (index, file, result) {                    $('#demo1').attr('src', result); //图片链接（base64）                });            }            , done: function (res) {                if (res.code == 1) {                    return layer.msg('文件上传失败');                }                if (res.code == 2) {                    return layer.msg('文件类型错误');                }                if (res.code == 3) {                    return layer.msg('头像路径存储不成功');                }                if (res.code == 4) {                    return layer.msg('没选择文件');                }                if (res.code == 0) {                    //iframe子文档通过父文档的id修改父文档内容                    parent.document.getElementById("userPhoto").src = res.headPath;                    sessionStorage.setItem("headPath", res.headPath);                    return layer.msg('头像上传成功');                }                //上传成功            }            , error: function () {                //演示失败状态，并实现重传                var demoText = $('#demoText');                demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');                demoText.find('.demo-reload').on('click', function () {                    uploadInst.upload();                });            }        });    });    layui.use(['form', 'layedit', 'laydate'], function () {        var form = layui.form            , layer = layui.layer            , laydate = layui.laydate;        //日期        laydate.render({            elem: '#birthday'        });    });</script></body></html>
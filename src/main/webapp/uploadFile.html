<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <title>Title</title>    <link rel="stylesheet" href="node_modules/layui-src/dist/css/layui.css">    <script type="text/javascript" src="node_modules/jquery/dist/jquery.min.js"></script>    <script type="text/javascript" src="node_modules/layui-src/dist/layui.all.js"></script>    <script>        var fileType = "";        var str = "";        $(function () {            layui.form.on('select(parentid)', function (data) {                str = "";                var obj = sessionStorage.getItem("fileDir");                var jsonObj = JSON.parse(obj);                $.each(jsonObj.children, function (index, row) {                    if (row.value == data.value) {                        $.each(row.children, function (index, col) {                            str += "<option value='" + col.value + "'>" + col.name + "</option>";                        });                        $("#childrenDir").html(str);                        layui.form.render();//layui更新select 需要重新渲染                    }                });            });            $.ajax({                url: "dir/dirAnalysis.do",                data: {"user_id": sessionStorage.getItem("user_id")},                success: function (data) {                    var jsonObject = JSON.parse(data);                    sessionStorage.setItem("fileDir", data);                    $.each(jsonObject.children, function (index, row) {                        str += "<option value='" + row.value + "'>" + row.name + "</option>";                    });                    $("#parentdir").html(str);                    layui.form.render();//layui更新select 需要重新渲染                },                error: function () {                    layer.msg("请求服务器失败！");                }            });            layui.use(['upload', 'form'], function () {                var $ = layui.jquery                    , form = layui.form                    , upload = layui.upload;                form.on('select(fileType)', function (data) {                    if (data.value == "isPicture") {                        sessionStorage.setItem("filterFileType", "images");                    }                    if (data.value == "isVideo") {                        sessionStorage.setItem("filterFileType", "video");                    }                    if (data.value == "isAudio") {                        sessionStorage.setItem("filterFileType", "audio");                    }                    if (data.value == "isDocument") {                        sessionStorage.setItem("filterFileType", "file");                    }                });//多文件列表示例                var demoListView = $('#demoList')                    , uploadListIns = upload.render({                    elem: '#testList'                    , url: 'file/uploadUserFile.do'                    , multiple: true                    , accept: $("#fileType").val()                    , auto: false                    , bindAction: '#testListAction'                    , before: function (obj) {                        this.data = {                            "user_id": sessionStorage.getItem("user_id"),                            "file_type": $("#fileType").val(),                            "dir_id": $("#childrenDir").val()                        };                    }                    , choose: function (obj) {                        var files = this.files = obj.pushFile(); //将每次选择的文件追加到文件队列                        //读取本地文件                        obj.preview(function (index, file, result) {                            var tr = $(['<tr id="upload-' + index + '">'                                , '<td>' + file.name + '</td>'                                , '<td>' + (file.size / 1014).toFixed(1) + 'kb</td>'                                , '<td>等待上传</td>'                                , '<td>'                                , '<button class="layui-btn layui-btn-xs demo-reload layui-hide">重传</button>'                                , '<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>'                                , '</td>'                                , '</tr>'].join(''));                            //单个重传                            tr.find('.demo-reload').on('click', function () {                                obj.upload(index, file);                            });                            //删除                            tr.find('.demo-delete').on('click', function () {                                delete files[index]; //删除对应的文件                                tr.remove();                                uploadListIns.config.elem.next()[0].value = ''; //清空 input file 值，以免删除后出现同名文件不可选                            });                            demoListView.append(tr);                        });                    }                    , done: function (res, index, upload) {                        if (res.code == 0) { //上传成功                            var tr = demoListView.find('tr#upload-' + index)                                , tds = tr.children();                            tds.eq(2).html('<span style="color: #5FB878;">上传成功</span>');                            tds.eq(3).html(''); //清空操作                            return delete this.files[index]; //删除文件队列已经上传成功的文件                        }                        this.error(index, upload);                    }                    , error: function (index, upload) {                        var tr = demoListView.find('tr#upload-' + index)                            , tds = tr.children();                        tds.eq(2).html('<span style="color: #FF5722;">上传失败</span>');                        tds.eq(3).find('.demo-reload').removeClass('layui-hide'); //显示重传                    }                });                form.render();            });        });    </script></head><body><!--多文件上传--><div class="layui-container">    <form class="layui-form" action="">        <div class="layui-form-item" align="left">            <div class="layui-input-block" style="width: auto">                <label class="layui-form-label">上传目录</label>                <div class="layui-input-inline">                    <select id="parentdir" lay-verify="required" lay-search="" lay-filter="parentid">                    </select>                </div>                <div class="layui-input-inline">                    <select id="childrenDir" lay-verify="required" lay-search="">                    </select>                </div>            </div>        </div>        <div class="layui-form-item" align="left">            <div class="layui-input-block">                <label class="layui-form-label" style="width: auto">上传文件类型</label>                <div class="layui-input-inline">                    <select id="fileType" lay-verify="required" lay-filter="fileType">                        <option value="isVideo">视频</option>                        <option value="isAudio">音频</option>                        <option value="isPicture" selected>图片</option>                        <option value="isDocument">文档</option>                    </select>                </div>            </div>        </div>    </form>    <div id="fileListDiv" class="layui-upload">        <div class="layui-upload-list">            <table class="layui-table">                <thead>                <tr>                    <th>文件名</th>                    <th>大小</th>                    <th>状态</th>                    <th>操作</th>                </tr>                </thead>                <tbody id="demoList"></tbody>            </table>        </div>        <button type="button" class="layui-btn layui-btn-primary" id="testList" style="width: 100%;height: 150px"><i class="layui-icon" style="font-size: 30px"></i><br>点击选择，或将文件拖拽到此处</button>        <button type="button" class="layui-btn" id="testListAction">开始上传</button>    </div></div></body></html>